
function addMulti(a,b){$clone=a.clone();$clone.removeClass("hide dummy");$clone.find(".editable").removeClass("dummy");$clone.find(".editable").editable({disabled:$(this).hasClass("editable-disabled"),onblur:$(this).hasClass("editable-noblur")?"cancel":"submit"}).on("save",function(d,f){if(this.getAttribute("data-pk")=="0"){var c=$.parseJSON(f.response);$(this).parents("fieldset.multi").find("div.loading-overlay").remove();addEditablePk($(this).parents("fieldset"),c.encrypted_id,c.id);presenceChannelCurrent.trigger("client-multi-add",{user:presenceChannelCurrent.members.me,pk:c,context:a.attr("data-name")});presenceChannelCurrent.trigger("client-editable-save",{user:presenceChannelCurrent.members.me,name:this.getAttribute("data-name"),pk:this.getAttribute("data-pk"),newValue:f.newValue,id:this.id})}if(this.getAttribute("data-name")=="type"&&this.getAttribute("data-context")=="payment"){$(this).parents("fieldset.fieldset-payment").find('div[class^="payment-"]').hide();$(this).parents("fieldset.fieldset-payment").find("div.payment-"+f.newValue).show()}}).on("shown",function(c){presenceChannelCurrent.trigger("client-editable-shown",{user:presenceChannelCurrent.members.me,name:this.getAttribute("data-name"),pk:this.getAttribute("data-pk"),id:this.id})}).on("hidden",function(d,c){presenceChannelCurrent.trigger("client-editable-hidden",{user:presenceChannelCurrent.members.me,name:this.getAttribute("data-name"),pk:this.getAttribute("data-pk"),id:this.id})}).on("save",function(c,d){if($(this).editable("option","pk")!=="0"){presenceChannelCurrent.trigger("client-editable-save",{user:presenceChannelCurrent.members.me,name:this.getAttribute("data-name"),pk:this.getAttribute("data-pk"),newValue:d.newValue,id:this.id})}}).on("submit",function(){if(this.getAttribute("data-pk")=="0"){$(this).parents("fieldset.multi").prepend("<div class='loading-overlay'></div>")}}).on("error",function(){if(this.getAttribute("data-pk")=="0"){$(this).parents("fieldset.multi").find("div.loading-overlay").remove()}});if(typeof b!=="undefined"){addEditablePk($clone,b.encrypted_id,b.id)}a.parents(".jarviswidget").find("form").prepend($clone);return true}function addEditablePk(d,b,c){var a=d.find("a.editable");a.editable("option","pk",b);a.attr("data-pk",b);a.each(function(){$this=$(this);$this.attr("id",$this.attr("data-context")+"_"+$this.attr("data-name")+"_"+c)});a.editable("option","pk",b);a.attr("data-pk",b);a.editable("enable");return true}(window.acp_edit=function(){$("a.btn-ribbon-cancel").on("click",function(h){h.preventDefault();var g=$(this);$.SmartMessageBox({title:"<i class='fa fa-times txt-color-red'></i> <span class='txt-color-red'><strong>Are you sure you wish to cancel '"+document.getElementById("project-name").value+"' ?</strong></span> ?",content:"The form will be locked from editing after cancellation",buttons:"[No][Yes]"},function(i){if(i=="Yes"){Messenger({extraClasses:"messenger-on-top messenger-fixed"}).run({id:"notif-top",errorMessage:"Error cancelling accounts payable",successMessage:"Accounts payable has been cancelled",progressMessage:"Please Wait...",action:$.ajax,},{type:"POST",url:g.attr("href"),success:function(){window.setTimeout(function(){$("a.btn-ribbon-refresh").click()},"2000")},error:function(l,j,k){return l.responseText}})}});return false});$("a.btn-mark-important").on("click",function(h){h.preventDefault();var g=$(this);var i=g.children("i").hasClass("fa-exclamation-triangle");$.SmartMessageBox({title:"<i class='fa fa-times txt-color-red'></i> <span class='txt-color-red'><strong>Are you sure you wish to "+(i?"unmark":"mark")+" this accounts payable as important?</strong></span> ?",content:"All accounts payable users will receive a notice",buttons:"[No][Yes]"},function(j){if(j=="Yes"){g.attr("disabled");Messenger({extraClasses:"messenger-on-top messenger-fixed"}).run({id:"notif-top",errorMessage:"Error marking accounts payable",successMessage:"Accounts Payable has been "+(i?"unmarked":"marked")+" as important",progressMessage:"Please Wait...",action:$.ajax,},{type:"PUT",url:g.attr("href"),success:function(){if(i){g.attr("data-original-title","Mark as important");g.children("i").removeClass("fa-exclamation-triangle");g.children("i").addClass("fa-exclamation");g.tooltip()}else{g.attr("data-original-title","Unmark as important");g.children("i").addClass("fa-exclamation-triangle");g.children("i").removeClass("fa-exclamation");g.tooltip()}g.removeAttr("disabled")},error:function(m,k,l){g.removeAttr("disabled");return m.responseText}})}});return false});$("a.btn-help").on("click",function(h){h.preventDefault();var g=$(this);g.attr("disabled","disabled");g.addClass("loading-animation");$.ajax({url:g.attr("data-href"),type:"GET",success:function(i){$.smallBox({title:"Help information",content:i,color:"#5384AF",icon:"fa fa-question"});g.removeAttr("disabled");g.removeClass("loading-animation")},error:function(k,i,j){$.smallBox({title:"Help information",content:k.responseText,color:"#5384AF",icon:"fa fa-question"});g.removeAttr("disabled");g.removeClass("loading-animation")}})});pusherSubscribeCurrentPresenceChannel(true,true);$.fn.editable.defaults.mode="inline";$.fn.editable.defaults.ajaxOptions={type:"put"};$(".editable:not(.dummy)").each(function(){var g=$(this);if(this.getAttribute("data-type")=="select2"&&this.getAttribute("data-name")=="supplier_code"&&this.getAttribute("data-context")=="generalinfo"){g.editable({disabled:g.hasClass("editable-disabled"),onblur:g.hasClass("editable-noblur")?"cancel":"submit",placeholder:"Select a supplier",select2:{allowClear:false,minimumInputLength:3,id:function(h){return h.id},ajax:{url:"/ajaxsearch/searchsupplier",data:function(h,i){return{term:h,limit:10,page:i}},results:function(k,j){var h=(j*10)<k.total;if(k.total>0){var i;i=$.map(k.suppliers,function(l){return{id:l.Supplier_Code,name:$.trim(l.Supplier_Name),text:$.trim(l.Supplier_Name)+" (Code:"+l.Supplier_Code+")"}});return{results:i,more:h}}else{return{results:""}}},},formatSelection:function(h){return h.text},initSelection:function(h,i){i({id:h.val(),text:h.parents("div.editable-select2").children("a.editable").html()})}}})}else{if(this.getAttribute("data-type")=="select2"&&this.getAttribute("data-name")=="billable_company_code"&&this.getAttribute("data-context")=="generalinfo"){g.editable({disabled:g.hasClass("editable-disabled"),onblur:g.hasClass("editable-noblur")?"cancel":"submit",placeholder:"Select a billable company",select2:{allowClear:false,minimumInputLength:3,id:function(h){return h.id},ajax:{url:"/ajaxsearch/customercode",dataType:"json",quietMillis:500,data:function(h,i){return{term:h,limit:10,page:i}},results:function(k,j){var h=(j*10)<k.total;if(k.total>0){var i;i=$.map(k.customers,function(l){return{id:l.AN8,name:l.ALPH,text:l.ALPH+" (Code:"+l.AN8+")",category:l.AC09}});return{results:i,more:h}}else{return{results:""}}},},formatSelection:function(h){return h.text},initSelection:function(h,i){i({id:h.val(),text:h.parents("div.editable-select2").children("a.editable").html()})}}})}else{g.editable({disabled:g.hasClass("editable-disabled"),onblur:g.hasClass("editable-noblur")?"cancel":"submit",})}}g.on("shown",function(h){presenceChannelCurrent.trigger("client-editable-shown",{user:presenceChannelCurrent.members.me,name:this.getAttribute("data-name"),pk:this.getAttribute("data-pk"),id:this.id});return true}).on("hidden",function(i,h){presenceChannelCurrent.trigger("client-editable-hidden",{user:presenceChannelCurrent.members.me,name:this.getAttribute("data-name"),pk:this.getAttribute("data-pk"),id:this.id});return true}).on("save",function(h,i){if($(this).editable("option","pk")!=="0"){$(this).editable("option","pk",this.getAttribute("data-pk"));presenceChannelCurrent.trigger("client-editable-save",{user:presenceChannelCurrent.members.me,name:this.getAttribute("data-name"),pk:this.getAttribute("data-pk"),newValue:i.newValue,id:this.id})}if(this.getAttribute("data-name")=="type"&&this.getAttribute("data-context")=="payment"){$(this).parents("fieldset.fieldset-payment").find('div[class^="payment-"]').hide();$(this).parents("fieldset.fieldset-payment").find("div.payment-"+i.newValue).show()}return true})});$(".creditnote-editable, .purchaseorder-editable, .invoice-editable, .paymentvoucher-editable, .payment-editable").on("save",function(i,j){var h=$(this);if(this.getAttribute("data-pk")=="0"){h.parents("fieldset.multi").find("div.loading-overlay").remove();var g=$.parseJSON(j.response);addEditablePk($(this).parents("fieldset"),g.encrypted_id,g.id);presenceChannelCurrent.trigger("client-multi-add",{user:presenceChannelCurrent.members.me,pk:g,context:h.parents("fieldset").attr("data-name")});presenceChannelCurrent.trigger("client-editable-save",{user:presenceChannelCurrent.members.me,name:h.attr("data-name"),pk:h.attr("data-pk"),newValue:j.newValue,id:this.id})}return true}).on("submit",function(){if(this.getAttribute("data-pk")=="0"){$(this).parents("fieldset.multi").prepend("<div class='loading-overlay'></div>")}}).on("error",function(){if(this.getAttribute("data-pk")=="0"){$(this).parents("fieldset.multi").find("div.loading-overlay").remove()}});$(".btn-add-new").on("click",function(){var i=$(this);var h=i.parents(".jarviswidget").find("fieldset.dummy");if(h.length){var g=$.maindiv.find(".editable-container");if(g.length){if(g.prev().hasClass("editable")){g.prev().editable("hide")}}addMulti(h)}else{messenger_notiftop("Error: Cannot add new record","error")}});$(".jarviswidget").on("click","fieldset.multi .btn-delete",function(){var j=$(this);var i=j.parents(".widget-body");console.log(j);if(confirm("Are you sure you wish to delete this record?")){var h=j.parents("fieldset.multi").attr("data-name").ucfirst();var g=j.parents("fieldset.multi").find("a.editable:first");if(g.attr("data-pk")=="0"){j.parents("fieldset.multi").slideUp("500",function(){$(this).remove();messenger_notiftop(h+" entry has been deleted","success");window.setTimeout(function(){if(i.find("fieldset.multi").not(".dummy").length==0){var k=i.find("fieldset.dummy");if(k.length){addMulti(k);messenger_notiftop(h+" dummy entry has been added","info")}}},0)})}else{Messenger({extraClasses:"messenger-on-top messenger-fixed"}).run({id:"notif-top",errorMessage:"Error removing "+h+" entry",successMessage:h+" entry has been deleted",progressMessage:"Please Wait...",action:$.ajax,},{type:"DELETE",url:j.attr("href"),data:{pk:g.attr("data-pk")},success:function(){presenceChannelCurrent.trigger("client-multi-delete",{user:presenceChannelCurrent.members.me,id:g.attr("id"),context:j.parents("fieldset.multi").attr("data-name")});j.parents("fieldset.multi").slideUp("500",function(){$(this).remove();window.setTimeout(function(){if(i.find("fieldset.multi").not(".dummy").length==0){var k=i.find("fieldset.dummy");if(k.length){addMulti(k);messenger_notiftop(h+" dummy entry has been added","info")}}},0)})},error:function(m,k,l){return m.responseText}})}}return false});$("#acp-list").on("click","tr[data-url] td",function(){$.pjax({url:$(this).parent("tr").attr("data-url"),container:"#main"})});$("a.btn-force-update").on("click",function(h){h.preventDefault();var g=$(this);g.attr("disabled","disabled");g.addClass("loading-animation");$.ajax({url:g.attr("data-href"),type:"GET",success:function(i){$.smallBox({title:"Workflow information",content:i,color:"#26A65B",icon:"fa fa-check"});g.removeAttr("disabled");g.removeClass("loading-animation")},error:function(k,i,j){g.removeAttr("disabled");g.removeClass("loading-animation");return k.responseText}})});var b=document.querySelector("#template");var f=b.parentNode.innerHTML;b.style.display="none";var e;var a=new Dropzone(document.getElementById("content"),{url:"/accounts-payable/upload/"+$("#id").val(),clickable:"#btn-upload",previewsContainer:"#upload-preview",previewTemplate:f,autoQueue:true,createImageThumbnails:false,accept:function(h,g){if(h.name.indexOf("+")!==-1){g("Please remove the plus sign from your document's name.")}else{g()}},addedfile:function(j){var i,s,q,p,l,t,h,g,r,o,k,m;if(this.element===this.previewsContainer){this.element.classList.add("dz-started")}if(this.previewsContainer){j.previewElement=Dropzone.createElement(this.options.previewTemplate.trim());j.previewTemplate=j.previewElement;this.previewsContainer.appendChild(j.previewElement);r=j.previewElement.querySelectorAll("[data-dz-name]");for(q=0,t=r.length;q<t;q++){i=r[q];i.textContent=j.name}o=j.previewElement.querySelectorAll("[data-dz-size]");for(p=0,h=o.length;p<h;p++){i=o[p];i.innerHTML=this.filesize(j.size)}if(this.options.addRemoveLinks){j._removeLink=Dropzone.createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+this.options.dictRemoveFile+"</a>");j.previewElement.appendChild(j._removeLink)}e=(function(u){return function(v){v.preventDefault();v.stopPropagation();if(j.status===Dropzone.UPLOADING){return Dropzone.confirm(u.options.dictCancelUploadConfirmation+j.name+" ?",function(){return u.removeFile(j)})}else{if(u.options.dictRemoveFileConfirmation){return Dropzone.confirm(u.options.dictRemoveFileConfirmation+j.name+" ?",function(){var w=Messenger({extraClasses:"messenger-fixed messenger-on-bottom messenger-on-right"}).post({type:"info",message:"Deleting file "+j.name});if($(j.previewElement).hasClass("dz-error")){u.removeFile(j)}else{$.ajax({type:"DELETE",url:"/accounts-payable/upload/"+$(j.previewElement).attr("data-id"),success:function(){w.update({type:"success",message:j.name+" has been deleted",hideAfter:3,showCloseButton:true});u.removeFile(j)},error:function(z,x,y){w.update({type:"error",message:z.responseText,showCloseButton:true})}})}return true})}else{return u.removeFile(j)}}}})(this);k=j.previewElement.querySelectorAll("[data-dz-remove]");m=[];for(l=0,g=k.length;l<g;l++){s=k[l];m.push(s.addEventListener("click",e))}return m}},init:function(){$("#upload-preview .btn.delete").on("click",function(){var g=$(this).closest(".row.dz-success");if(confirm("Are you sure you want to delete this file: "+g.attr("data-name")+" ?")){var h=Messenger({extraClasses:"messenger-fixed messenger-on-bottom messenger-on-right"}).post({type:"info",message:"Deleting file "+g.attr("data-name")});$.ajax({type:"DELETE",url:"/accounts-payable/upload/"+g.attr("data-id"),success:function(){h.update({type:"success",message:g.attr("data-name")+" has been deleted",hideAfter:3,showCloseButton:true});g.remove()},error:function(k,i,j){h.update({type:"error",message:k.responseText,showCloseButton:true})}})}return false})}});a.on("sending",function(h,j,g){uploadmsg=Messenger({extraClasses:"messenger-fixed messenger-on-bottom messenger-on-right"}).post({message:'Uploading "'+h.name+'" <div class="progress progress-sm progress-striped active"><div aria-valuetransitiongoal="25" class="progress-bar bg-color-blue" id="upload-progress" style="width: 0%;" aria-valuenow="25"></div> </div>',hideAfter:0,showCloseButton:false,type:"info",id:"uploadmsg"});switch(h.type){case"image/jpeg":case"image/png":case"image/bmp":case"image/jpg":var i='<i class="fa fa-file-image-o"></i>';break;case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":case"application/vnd.ms-excel":var i='<i class="fa fa-file-excel-o"></i>';break;case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":case"application/msword":var i='<i class="fa fa-file-word-o"></i>';break;case"application/pdf":var i='<i class="fa fa-file-pdf-o"></i>';break;default:var i='<i class="fa fa-file-o"></i>';break}$(h.previewElement).find("span.name").prepend(i);$(h.previewElement).find("div.progress").removeClass("hide");return h});a.on("success",function(j,h){Messenger({extraClasses:"messenger-fixed messenger-on-bottom messenger-on-right"}).post({showCloseButton:true,type:"success",message:"Upload Complete: "+j.name,hideAfter:3});var i=$.parseJSON(h);if(i.success){$(j.previewElement).find("span.name").wrapInner("<a class='file-view' rel='tooltip' data-original-title='Last update: "+i.updated_on+" &#013; Updated By: "+i.updated_by+"' data-placement='bottom' href='"+i.url+"'/>");$(j.previewElement).attr("data-id",i.id);$(j.previewElement).find("[rel=tooltip]").tooltip();var g=$(j.previewElement).find("a.editable");g.html("");g.attr("data-pk",i.id);g.attr("id",i.id_normal);g.removeAttr("data-value");g.editable();g.removeClass("dummy hide")}$(j.previewElement).find("div.progress").addClass("hide");return j});a.on("cancelled",function(){if(typeof uploadmsg!==null){uploadmsg.hide()}Messenger({extraClasses:"messenger-fixed messenger-on-bottom messenger-on-right"}).post({showCloseButton:true,type:"info",hideAfter:3,message:'Upload Cancelled: "'+file.name+'"'})});a.on("error",function(g,h,i){Messenger({extraClasses:"messenger-fixed messenger-on-bottom messenger-on-right"}).post({showCloseButton:true,type:"error",hideAfter:0,message:'Upload Failed: "'+g.name+'" - '+h})});a.on("uploadprogress",function(i,h){var g=$("#upload-progress");if(g[0].length!=0){g.animate({width:h+"%"},500)}});a.on("totaluploadprogress",function(g){if(typeof uploadmsg!=="undefined"&&g==100){uploadmsg.hide()}});var c=document.getElementById("content");var d=new Dragster(c);c.addEventListener("dragster:enter",function(g){for(n in g.detail.dataTransfer.types){if(g.detail.dataTransfer.types[n]==="Files"){g.target.classList.add("dragged-over");break}}},false);c.addEventListener("dragster:leave",function(g){g.target.classList.remove("dragged-over")},false);$("#content").on("drop",function(g){d.dragleave(g)});$("#acp-docs").on("click","a.file-view",function(h){h.preventDefault();var g=$(this);if(g.attr("href").indexOf(".jpg")!==-1||g.attr("href").indexOf(".jpeg")!==-1||g.attr("href").indexOf(".png")!==-1||g.attr("href").indexOf(".bmp")!==-1){$.colorbox({href:g.attr("href"),maxHeight:"100%",maxWidth:"90%",innerWidth:"100%",innerHeight:"100%",initialWidth:"64px",initialHeight:"84px",closeButton:true,iframe:false,})}else{$.colorbox({href:"http://docs.google.com/viewer?url="+g.attr("href")+"&embedded=true",maxHeight:"100%",maxWidth:"90%",innerWidth:"100%",innerHeight:"100%",initialWidth:"64px",initialHeight:"84px",closeButton:true,iframe:true,})}});$.document_.bind("cbox_complete",function(){$("html").css({overflow:"hidden"})}).bind("cbox_closed",function(){$("html").css({overflow:"auto"})});$("a.btn-publish").on("click",function(h){h.preventDefault();var g=$(this);$.SmartMessageBox({title:"<span class='txt-color-greenDark'><i class='fa fa-share'></i> Publish Form?</span>",content:"A notification will be sent to the responsible parties",buttons:"[No][Yes]"},function(i){if(i=="Yes"){Messenger({extraClasses:"messenger-on-top messenger-fixed"}).run({id:"notif-top",errorMessage:"Error: form not published",successMessage:"Form has been published",progressMessage:"Please Wait...",action:$.ajax,},{type:"POST",url:g.attr("href"),success:function(){window.setTimeout(function(){$("a.btn-ribbon-refresh:first").click()},"2000")},error:function(l,j,k){return l.responseText}})}else{return false}});return false});enableComments();messenger_hidenotiftop()})();